# Generated by go2rpm 1.3
%bcond_without check

# https://github.com/coredns/coredns
%global goipath         github.com/coredns/coredns
Version:                1.8.4

%gometa

%global common_description %{expand:
CoreDNS is a DNS server that chains plugins.}

%global golicenses      LICENSE
%global godocs          ADOPTERS.md CODE_OF_CONDUCT.md CONTRIBUTING.md\\\
                        GOVERNANCE.md README.md SECURITY.md corefile.5.md\\\
                        plugin.md coredns.1.md notes/coredns-0.9.10.md\\\
                        notes/coredns-0.9.9.md notes/coredns-001.md\\\
                        notes/coredns-002.md notes/coredns-003.md\\\
                        notes/coredns-004.md notes/coredns-005.md\\\
                        notes/coredns-006.md notes/coredns-007.md\\\
                        notes/coredns-008.md notes/coredns-009.md\\\
                        notes/coredns-010.md notes/coredns-011.md\\\
                        notes/coredns-1.0.0.md notes/coredns-1.0.1.md\\\
                        notes/coredns-1.0.2.md notes/coredns-1.0.3.md\\\
                        notes/coredns-1.0.4.md notes/coredns-1.0.5.md\\\
                        notes/coredns-1.0.6.md notes/coredns-1.1.0.md\\\
                        notes/coredns-1.1.1.md notes/coredns-1.1.2.md\\\
                        notes/coredns-1.1.3.md notes/coredns-1.1.4.md\\\
                        notes/coredns-1.2.0.md notes/coredns-1.2.1.md\\\
                        notes/coredns-1.2.2.md notes/coredns-1.2.3.md\\\
                        notes/coredns-1.2.4.md notes/coredns-1.2.5.md\\\
                        notes/coredns-1.2.6.md notes/coredns-1.3.0.md\\\
                        notes/coredns-1.3.1.md notes/coredns-1.4.0.md\\\
                        notes/coredns-1.5.0.md notes/coredns-1.5.1.md\\\
                        notes/coredns-1.5.2.md notes/coredns-1.6.0.md\\\
                        notes/coredns-1.6.1.md notes/coredns-1.6.2.md\\\
                        notes/coredns-1.6.3.md notes/coredns-1.6.4.md\\\
                        notes/coredns-1.6.5.md notes/coredns-1.6.6.md\\\
                        notes/coredns-1.6.7.md notes/coredns-1.6.8.md\\\
                        notes/coredns-1.6.9.md notes/coredns-1.7.0.md\\\
                        notes/coredns-1.7.1.md notes/coredns-1.8.0.md\\\
                        notes/coredns-1.8.1.md notes/coredns-1.8.2.md\\\
                        notes/coredns-1.8.3.md notes/coredns-1.8.4.md\\\
                        plugin/acl/README.md plugin/any/README.md\\\
                        plugin/auto/README.md plugin/autopath/README.md\\\
                        plugin/azure/README.md plugin/bind/README.md\\\
                        plugin/bufsize/README.md plugin/cache/README.md\\\
                        plugin/cancel/README.md plugin/chaos/README.md\\\
                        plugin/clouddns/README.md plugin/debug/README.md\\\
                        plugin/dns64/README.md plugin/dnssec/README.md\\\
                        plugin/dnstap/README.md plugin/erratic/README.md\\\
                        plugin/errors/README.md plugin/etcd/README.md\\\
                        plugin/file/README.md plugin/forward/README.md\\\
                        plugin/grpc/README.md plugin/health/README.md\\\
                        plugin/hosts/README.md plugin/import/README.md\\\
                        plugin/k8s_external/README.md\\\
                        plugin/kubernetes/README.md\\\
                        plugin/loadbalance/README.md plugin/local/README.md\\\
                        plugin/log/README.md plugin/loop/README.md\\\
                        plugin/metadata/README.md plugin/metrics/README.md\\\
                        plugin/minimal/README.md plugin/nsid/README.md\\\
                        plugin/pprof/README.md plugin/ready/README.md\\\
                        plugin/reload/README.md plugin/rewrite/README.md\\\
                        plugin/root/README.md plugin/route53/README.md\\\
                        plugin/secondary/README.md plugin/sign/README.md\\\
                        plugin/template/README.md plugin/tls/README.md\\\
                        plugin/trace/README.md plugin/transfer/README.md\\\
                        plugin/whoami/README.md

Name:           %{goname}
Release:        1%{?dist}
Summary:        CoreDNS is a DNS server that chains plugins

# Upstream license specification: Apache-2.0
License:        ASL 2.0
URL:            %{gourl}
Source0:        %{gosource}

BuildRequires:  golang(github.com/apparentlymart/go-cidr/cidr)
BuildRequires:  golang(github.com/aws/aws-sdk-go/aws)
BuildRequires:  golang(github.com/aws/aws-sdk-go/aws/credentials)
BuildRequires:  golang(github.com/aws/aws-sdk-go/aws/credentials/ec2rolecreds)
BuildRequires:  golang(github.com/aws/aws-sdk-go/aws/ec2metadata)
BuildRequires:  golang(github.com/aws/aws-sdk-go/aws/session)
BuildRequires:  golang(github.com/aws/aws-sdk-go/service/route53)
BuildRequires:  golang(github.com/aws/aws-sdk-go/service/route53/route53iface)
BuildRequires:  golang(github.com/Azure/azure-sdk-for-go/profiles/latest/dns/mgmt/dns)
BuildRequires:  golang(github.com/Azure/azure-sdk-for-go/profiles/latest/privatedns/mgmt/privatedns)
BuildRequires:  golang(github.com/Azure/go-autorest/autorest/azure)
BuildRequires:  golang(github.com/Azure/go-autorest/autorest/azure/auth)
BuildRequires:  golang(github.com/coredns/caddy)
BuildRequires:  golang(github.com/coredns/caddy/caddyfile)
BuildRequires:  golang(github.com/coredns/caddy/onevent)
BuildRequires:  golang(github.com/dnstap/golang-dnstap)
BuildRequires:  golang(github.com/farsightsec/golang-framestream)
BuildRequires:  golang(github.com/golang/protobuf/proto)
BuildRequires:  golang(github.com/grpc-ecosystem/grpc-opentracing/go/otgrpc)
BuildRequires:  golang(github.com/infobloxopen/go-trees/iptree)
BuildRequires:  golang(github.com/matttproud/golang_protobuf_extensions/pbutil)
BuildRequires:  golang(github.com/miekg/dns)
BuildRequires:  golang(github.com/opentracing/opentracing-go)
BuildRequires:  golang(github.com/openzipkin-contrib/zipkin-go-opentracing)
BuildRequires:  golang(github.com/openzipkin/zipkin-go)
BuildRequires:  golang(github.com/openzipkin/zipkin-go/reporter/http)
BuildRequires:  golang(github.com/prometheus/client_golang/prometheus)
BuildRequires:  golang(github.com/prometheus/client_golang/prometheus/promauto)
BuildRequires:  golang(github.com/prometheus/client_golang/prometheus/promhttp)
BuildRequires:  golang(github.com/prometheus/client_model/go)
BuildRequires:  golang(github.com/prometheus/common/expfmt)
BuildRequires:  golang(go.etcd.io/etcd/api/v3/mvccpb)
BuildRequires:  golang(go.etcd.io/etcd/client/v3)
BuildRequires:  golang(golang.org/x/crypto/ed25519)
BuildRequires:  golang(golang.org/x/sys/unix)
BuildRequires:  golang(google.golang.org/api/dns/v1)
BuildRequires:  golang(google.golang.org/api/option)
BuildRequires:  golang(google.golang.org/grpc)
BuildRequires:  golang(google.golang.org/grpc/codes)
BuildRequires:  golang(google.golang.org/grpc/credentials)
BuildRequires:  golang(google.golang.org/grpc/peer)
BuildRequires:  golang(google.golang.org/grpc/status)
BuildRequires:  golang(gopkg.in/DataDog/dd-trace-go.v1/ddtrace/ext)
BuildRequires:  golang(gopkg.in/DataDog/dd-trace-go.v1/ddtrace/opentracer)
BuildRequires:  golang(gopkg.in/DataDog/dd-trace-go.v1/ddtrace/tracer)
BuildRequires:  golang(k8s.io/api/core/v1)
BuildRequires:  golang(k8s.io/api/discovery/v1)
BuildRequires:  golang(k8s.io/api/discovery/v1beta1)
BuildRequires:  golang(k8s.io/apimachinery/pkg/api/errors)
BuildRequires:  golang(k8s.io/apimachinery/pkg/apis/meta/v1)
BuildRequires:  golang(k8s.io/apimachinery/pkg/labels)
BuildRequires:  golang(k8s.io/apimachinery/pkg/runtime)
BuildRequires:  golang(k8s.io/apimachinery/pkg/runtime/schema)
BuildRequires:  golang(k8s.io/apimachinery/pkg/types)
BuildRequires:  golang(k8s.io/apimachinery/pkg/watch)
BuildRequires:  golang(k8s.io/client-go/kubernetes)
BuildRequires:  golang(k8s.io/client-go/plugin/pkg/client/auth/gcp)
BuildRequires:  golang(k8s.io/client-go/plugin/pkg/client/auth/oidc)
BuildRequires:  golang(k8s.io/client-go/plugin/pkg/client/auth/openstack)
BuildRequires:  golang(k8s.io/client-go/rest)
BuildRequires:  golang(k8s.io/client-go/tools/cache)
BuildRequires:  golang(k8s.io/client-go/tools/clientcmd)
BuildRequires:  golang(k8s.io/client-go/tools/clientcmd/api)
BuildRequires:  golang(k8s.io/klog)

%if %{with check}
# Tests
BuildRequires:  golang(github.com/aws/aws-sdk-go/aws/request)
BuildRequires:  golang(github.com/opentracing/opentracing-go/mocktracer)
BuildRequires:  golang(github.com/prometheus/client_golang/prometheus/testutil/promlint)
BuildRequires:  golang(k8s.io/client-go/kubernetes/fake)
%endif

%description
%{common_description}

%gopkg

%prep
%goprep

%build
%gobuild -o %{gobuilddir}/bin/coredns %{goipath}

%install
%gopkginstall
install -m 0755 -vd                     %{buildroot}%{_bindir}
install -m 0755 -vp %{gobuilddir}/bin/* %{buildroot}%{_bindir}/

%if %{with check}
%check
%gocheck
%endif

%files
%license LICENSE
%doc ADOPTERS.md CODE_OF_CONDUCT.md CONTRIBUTING.md GOVERNANCE.md README.md
%doc SECURITY.md corefile.5.md plugin.md coredns.1.md notes/coredns-0.9.10.md
%doc notes/coredns-0.9.9.md notes/coredns-001.md notes/coredns-002.md
%doc notes/coredns-003.md notes/coredns-004.md notes/coredns-005.md
%doc notes/coredns-006.md notes/coredns-007.md notes/coredns-008.md
%doc notes/coredns-009.md notes/coredns-010.md notes/coredns-011.md
%doc notes/coredns-1.0.0.md notes/coredns-1.0.1.md notes/coredns-1.0.2.md
%doc notes/coredns-1.0.3.md notes/coredns-1.0.4.md notes/coredns-1.0.5.md
%doc notes/coredns-1.0.6.md notes/coredns-1.1.0.md notes/coredns-1.1.1.md
%doc notes/coredns-1.1.2.md notes/coredns-1.1.3.md notes/coredns-1.1.4.md
%doc notes/coredns-1.2.0.md notes/coredns-1.2.1.md notes/coredns-1.2.2.md
%doc notes/coredns-1.2.3.md notes/coredns-1.2.4.md notes/coredns-1.2.5.md
%doc notes/coredns-1.2.6.md notes/coredns-1.3.0.md notes/coredns-1.3.1.md
%doc notes/coredns-1.4.0.md notes/coredns-1.5.0.md notes/coredns-1.5.1.md
%doc notes/coredns-1.5.2.md notes/coredns-1.6.0.md notes/coredns-1.6.1.md
%doc notes/coredns-1.6.2.md notes/coredns-1.6.3.md notes/coredns-1.6.4.md
%doc notes/coredns-1.6.5.md notes/coredns-1.6.6.md notes/coredns-1.6.7.md
%doc notes/coredns-1.6.8.md notes/coredns-1.6.9.md notes/coredns-1.7.0.md
%doc notes/coredns-1.7.1.md notes/coredns-1.8.0.md notes/coredns-1.8.1.md
%doc notes/coredns-1.8.2.md notes/coredns-1.8.3.md notes/coredns-1.8.4.md
%doc plugin/acl/README.md plugin/any/README.md plugin/auto/README.md
%doc plugin/autopath/README.md plugin/azure/README.md plugin/bind/README.md
%doc plugin/bufsize/README.md plugin/cache/README.md plugin/cancel/README.md
%doc plugin/chaos/README.md plugin/clouddns/README.md plugin/debug/README.md
%doc plugin/dns64/README.md plugin/dnssec/README.md plugin/dnstap/README.md
%doc plugin/erratic/README.md plugin/errors/README.md plugin/etcd/README.md
%doc plugin/file/README.md plugin/forward/README.md plugin/grpc/README.md
%doc plugin/health/README.md plugin/hosts/README.md plugin/import/README.md
%doc plugin/k8s_external/README.md plugin/kubernetes/README.md
%doc plugin/loadbalance/README.md plugin/local/README.md plugin/log/README.md
%doc plugin/loop/README.md plugin/metadata/README.md plugin/metrics/README.md
%doc plugin/minimal/README.md plugin/nsid/README.md plugin/pprof/README.md
%doc plugin/ready/README.md plugin/reload/README.md plugin/rewrite/README.md
%doc plugin/root/README.md plugin/route53/README.md plugin/secondary/README.md
%doc plugin/sign/README.md plugin/template/README.md plugin/tls/README.md
%doc plugin/trace/README.md plugin/transfer/README.md plugin/whoami/README.md
%{_bindir}/*

%gopkgfiles

%changelog

