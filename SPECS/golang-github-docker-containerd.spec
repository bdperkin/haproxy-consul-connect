# Generated by go2rpm 1.3
%bcond_without check

# https://github.com/containerd/containerd
%global goipath         github.com/docker/containerd
%global forgeurl        https://github.com/containerd/containerd
Version:                0.2.9

%gometa

%global common_description %{expand:
An open and reliable container runtime.}

%global golicenses      NOTICE LICENSE.code LICENSE.docs
%global godocs          docs CONTRIBUTING.md README.md example

Name:           %{goname}
Release:        1%{?dist}
Summary:        An open and reliable container runtime

# Upstream license specification: Apache-2.0 and CC-BY-SA-4.0
License:        ASL 2.0 and CC-BY-SA-4.0
# FIXME: Upstream SPDX tag CC-BY-SA-4.0 not listed in Fedora's good licenses list.
# FIXME: This package might not be allowed in Fedora!

URL:            %{gourl}
Source0:        %{gosource}

BuildRequires:  golang(github.com/cloudfoundry/gosigar)
BuildRequires:  golang(github.com/containerd/console)
BuildRequires:  golang(github.com/containerd/go-runc)
BuildRequires:  golang(github.com/cyberdelia/go-metrics-graphite)
BuildRequires:  golang(github.com/docker/docker/pkg/listeners)
BuildRequires:  golang(github.com/golang/protobuf/proto)
BuildRequires:  golang(github.com/golang/protobuf/ptypes)
BuildRequires:  golang(github.com/golang/protobuf/ptypes/timestamp)
BuildRequires:  golang(github.com/opencontainers/runc/libcontainer/system)
BuildRequires:  golang(github.com/opencontainers/runtime-spec/specs-go)
BuildRequires:  golang(github.com/rcrowley/go-metrics)
BuildRequires:  golang(github.com/Sirupsen/logrus)
BuildRequires:  golang(github.com/tonistiigi/fifo)
BuildRequires:  golang(github.com/urfave/cli)
BuildRequires:  golang(golang.org/x/net/context)
BuildRequires:  golang(golang.org/x/sys/unix)
BuildRequires:  golang(google.golang.org/grpc)
BuildRequires:  golang(google.golang.org/grpc/codes)
BuildRequires:  golang(google.golang.org/grpc/grpclog)
BuildRequires:  golang(google.golang.org/grpc/health)
BuildRequires:  golang(google.golang.org/grpc/health/grpc_health_v1)
BuildRequires:  golang(google.golang.org/grpc/transport)

%description
%{common_description}

%gopkg

%prep
%goprep

%build
for cmd in containerd containerd-shim ctr hack integration-test; do
  %gobuild -o %{gobuilddir}/bin/$(basename $cmd) %{goipath}/$cmd
done

%install
%gopkginstall
install -m 0755 -vd                     %{buildroot}%{_bindir}
install -m 0755 -vp %{gobuilddir}/bin/* %{buildroot}%{_bindir}/

%if %{with check}
%check
%gocheck
%endif

%files
%license NOTICE LICENSE.code LICENSE.docs
%doc docs CONTRIBUTING.md README.md example
%{_bindir}/*

%gopkgfiles

%changelog

