# Generated by go2rpm 1.3
%bcond_without check

# https://github.com/influxdata/influxdb
%global goipath         github.com/influxdata/influxdb
Version:                1.9.0

%gometa

%global common_description %{expand:
Scalable datastore for metrics, events, and real-time analytics.}

%global golicenses      LICENSE
%global godocs          CODING_GUIDELINES.md QUERIES.md TODO.md\\\
                        CONTRIBUTING.md DEPENDENCIES.md CHANGELOG.md\\\
                        README.md kit/platform/errors/errors.md\\\
                        monitor/README.md releng/README.md\\\
                        logger/style_guide.md cmd/influx_inspect/README.md\\\
                        cmd/influx_tsm/README.md\\\
                        cmd/influx_tools/export/README.md\\\
                        cmd/influx_tools/importer/README.md man/README.md\\\
                        man/footer.txt man/influx.txt man/influx_inspect.txt\\\
                        man/influx_tsm.txt man/influxd-backup.txt\\\
                        man/influxd-config.txt man/influxd-restore.txt\\\
                        man/influxd-run.txt man/influxd-version.txt\\\
                        man/influxd.txt services/collectd/README.md\\\
                        services/collectd/test_client/README.md\\\
                        services/continuous_querier/continuous_queries.md\\\
                        services/graphite/README.md\\\
                        services/opentsdb/README.md\\\
                        services/precreator/README.md services/udp/README.md\\\
                        pkg/README.md pkg/snowflake/README.md\\\
                        client/README.md importer/README.md tsdb/README.md\\\
                        tsdb/engine/tsm1/DESIGN.md

Name:           %{goname}
Release:        1%{?dist}
Summary:        Scalable datastore for metrics, events, and real-time analytics

License:        MIT
URL:            %{gourl}
Source0:        %{gosource}

BuildRequires:  golang(collectd.org/api)
BuildRequires:  golang(collectd.org/network)
BuildRequires:  golang(github.com/apache/arrow/go/arrow)
BuildRequires:  golang(github.com/apache/arrow/go/arrow/array)
BuildRequires:  golang(github.com/apache/arrow/go/arrow/memory)
BuildRequires:  golang(github.com/bmizerany/pat)
BuildRequires:  golang(github.com/boltdb/bolt)
BuildRequires:  golang(github.com/BurntSushi/toml)
BuildRequires:  golang(github.com/cespare/xxhash)
BuildRequires:  golang(github.com/dgrijalva/jwt-go/v4)
BuildRequires:  golang(github.com/dgryski/go-bitstream)
BuildRequires:  golang(github.com/go-chi/chi)
BuildRequires:  golang(github.com/gogo/protobuf/gogoproto)
BuildRequires:  golang(github.com/gogo/protobuf/proto)
BuildRequires:  golang(github.com/gogo/protobuf/types)
BuildRequires:  golang(github.com/golang/mock/gomock)
BuildRequires:  golang(github.com/golang/snappy)
BuildRequires:  golang(github.com/influxdata/flux)
BuildRequires:  golang(github.com/influxdata/flux/arrow)
BuildRequires:  golang(github.com/influxdata/flux/ast)
BuildRequires:  golang(github.com/influxdata/flux/cmd/flux/cmd)
BuildRequires:  golang(github.com/influxdata/flux/codes)
BuildRequires:  golang(github.com/influxdata/flux/compiler)
BuildRequires:  golang(github.com/influxdata/flux/csv)
BuildRequires:  golang(github.com/influxdata/flux/dependencies/testing)
BuildRequires:  golang(github.com/influxdata/flux/execute)
BuildRequires:  golang(github.com/influxdata/flux/execute/table)
BuildRequires:  golang(github.com/influxdata/flux/interpreter)
BuildRequires:  golang(github.com/influxdata/flux/interval)
BuildRequires:  golang(github.com/influxdata/flux/lang)
BuildRequires:  golang(github.com/influxdata/flux/memory)
BuildRequires:  golang(github.com/influxdata/flux/metadata)
BuildRequires:  golang(github.com/influxdata/flux/parser)
BuildRequires:  golang(github.com/influxdata/flux/plan)
BuildRequires:  golang(github.com/influxdata/flux/runtime)
BuildRequires:  golang(github.com/influxdata/flux/semantic)
BuildRequires:  golang(github.com/influxdata/flux/stdlib)
BuildRequires:  golang(github.com/influxdata/flux/stdlib/influxdata/influxdb)
BuildRequires:  golang(github.com/influxdata/flux/stdlib/universe)
BuildRequires:  golang(github.com/influxdata/flux/values)
BuildRequires:  golang(github.com/influxdata/httprouter)
BuildRequires:  golang(github.com/influxdata/influxql)
BuildRequires:  golang(github.com/influxdata/roaring)
BuildRequires:  golang(github.com/influxdata/usage-client/v1)
BuildRequires:  golang(github.com/jsternberg/zap-logfmt)
BuildRequires:  golang(github.com/jwilder/encoding/simple8b)
BuildRequires:  golang(github.com/klauspost/pgzip)
BuildRequires:  golang(github.com/mattn/go-isatty)
BuildRequires:  golang(github.com/mileusna/useragent)
BuildRequires:  golang(github.com/opentracing/opentracing-go)
BuildRequires:  golang(github.com/opentracing/opentracing-go/ext)
BuildRequires:  golang(github.com/opentracing/opentracing-go/log)
BuildRequires:  golang(github.com/peterh/liner)
BuildRequires:  golang(github.com/pkg/errors)
BuildRequires:  golang(github.com/prometheus/client_golang/prometheus)
BuildRequires:  golang(github.com/prometheus/client_golang/prometheus/promhttp)
BuildRequires:  golang(github.com/prometheus/client_model/go)
BuildRequires:  golang(github.com/prometheus/common/expfmt)
BuildRequires:  golang(github.com/prometheus/prometheus/prompb)
BuildRequires:  golang(github.com/retailnext/hllpp)
BuildRequires:  golang(github.com/spf13/cast)
BuildRequires:  golang(github.com/spf13/cobra)
BuildRequires:  golang(github.com/tinylib/msgp/msgp)
BuildRequires:  golang(github.com/uber/jaeger-client-go)
BuildRequires:  golang(github.com/xlab/treeprint)
BuildRequires:  golang(go.uber.org/multierr)
BuildRequires:  golang(go.uber.org/zap)
BuildRequires:  golang(go.uber.org/zap/zapcore)
BuildRequires:  golang(golang.org/x/crypto/bcrypt)
BuildRequires:  golang(golang.org/x/crypto/ssh/terminal)
BuildRequires:  golang(golang.org/x/sync/errgroup)
BuildRequires:  golang(golang.org/x/sys/unix)
BuildRequires:  golang(golang.org/x/text/encoding/unicode)
BuildRequires:  golang(golang.org/x/text/transform)
BuildRequires:  golang(golang.org/x/time/rate)
BuildRequires:  golang(google.golang.org/grpc)
BuildRequires:  golang(google.golang.org/grpc/codes)
BuildRequires:  golang(google.golang.org/grpc/metadata)
BuildRequires:  golang(google.golang.org/grpc/status)

%if %{with check}
# Tests
BuildRequires:  golang(github.com/davecgh/go-spew/spew)
BuildRequires:  golang(github.com/google/go-cmp/cmp)
BuildRequires:  golang(github.com/google/go-cmp/cmp/cmpopts)
BuildRequires:  golang(github.com/opentracing/opentracing-go/mocktracer)
BuildRequires:  golang(github.com/stretchr/testify/assert)
BuildRequires:  golang(github.com/stretchr/testify/require)
BuildRequires:  golang(go.uber.org/zap/zaptest)
%endif

%description
%{common_description}

%gopkg

%prep
%goprep

%build
for cmd in cmd/* ; do
  %gobuild -o %{gobuilddir}/bin/$(basename $cmd) %{goipath}/$cmd
done
%gobuild -o %{gobuilddir}/bin/influxdb %{goipath}
for cmd in kit/feature/_codegen services/collectd/test_client _tools/tmpl; do
  %gobuild -o %{gobuilddir}/bin/$(basename $cmd) %{goipath}/$cmd
done

%install
%gopkginstall
install -m 0755 -vd                     %{buildroot}%{_bindir}
install -m 0755 -vp %{gobuilddir}/bin/* %{buildroot}%{_bindir}/

%if %{with check}
%check
%gocheck
%endif

%files
%license LICENSE
%doc CODING_GUIDELINES.md QUERIES.md TODO.md CONTRIBUTING.md DEPENDENCIES.md
%doc CHANGELOG.md README.md kit/platform/errors/errors.md monitor/README.md
%doc releng/README.md logger/style_guide.md cmd/influx_inspect/README.md
%doc cmd/influx_tsm/README.md cmd/influx_tools/export/README.md
%doc cmd/influx_tools/importer/README.md man/README.md man/footer.txt
%doc man/influx.txt man/influx_inspect.txt man/influx_tsm.txt
%doc man/influxd-backup.txt man/influxd-config.txt man/influxd-restore.txt
%doc man/influxd-run.txt man/influxd-version.txt man/influxd.txt
%doc services/collectd/README.md services/collectd/test_client/README.md
%doc services/continuous_querier/continuous_queries.md
%doc services/graphite/README.md services/opentsdb/README.md
%doc services/precreator/README.md services/udp/README.md pkg/README.md
%doc pkg/snowflake/README.md client/README.md importer/README.md tsdb/README.md
%doc tsdb/engine/tsm1/DESIGN.md
%{_bindir}/*

%gopkgfiles

%changelog

