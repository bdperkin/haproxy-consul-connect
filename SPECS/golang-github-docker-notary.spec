# Generated by go2rpm 1.3
%bcond_without check

# https://github.com/docker/notary
%global goipath         github.com/docker/notary
Version:                0.6.1

%gometa

%global common_description %{expand:
Notary is a project that allows anyone to have trust over arbitrary collections
of data.}

%global golicenses      LICENSE tuf/LICENSE
%global godocs          docs CONTRIBUTING.md CONTRIBUTORS\\\
                        MAINTAINERS_RULES.md README.md CHANGELOG.md\\\
                        ROADMAP.md fixtures/compatibility/README.md\\\
                        fixtures/compatibility/notary0.1/README.txt\\\
                        migrations/README.md trustmanager/importLogic.md\\\
                        tuf/README.md

Name:           %{goname}
Release:        1%{?dist}
Summary:        Notary is a project that allows anyone to have trust over arbitrary collections of data

# Upstream license specification: Apache-2.0 and BSD-3-Clause
License:        ASL 2.0 and BSD
URL:            %{gourl}
Source0:        %{gosource}

BuildRequires:  golang(github.com/agl/ed25519)
BuildRequires:  golang(github.com/bugsnag/bugsnag-go)
BuildRequires:  golang(github.com/docker/distribution/context)
BuildRequires:  golang(github.com/docker/distribution/health)
BuildRequires:  golang(github.com/docker/distribution/registry/api/errcode)
BuildRequires:  golang(github.com/docker/distribution/registry/auth)
BuildRequires:  golang(github.com/docker/distribution/registry/auth/htpasswd)
BuildRequires:  golang(github.com/docker/distribution/registry/auth/token)
BuildRequires:  golang(github.com/docker/distribution/registry/client/auth)
BuildRequires:  golang(github.com/docker/distribution/registry/client/auth/challenge)
BuildRequires:  golang(github.com/docker/distribution/registry/client/transport)
BuildRequires:  golang(github.com/docker/distribution/uuid)
BuildRequires:  golang(github.com/docker/go-connections/tlsconfig)
BuildRequires:  golang(github.com/docker/go/canonical/json)
BuildRequires:  golang(github.com/dvsekhvalnov/jose2go)
BuildRequires:  golang(github.com/go-sql-driver/mysql)
BuildRequires:  golang(github.com/golang/protobuf/proto)
BuildRequires:  golang(github.com/golang/protobuf/ptypes/empty)
BuildRequires:  golang(github.com/gorilla/mux)
BuildRequires:  golang(github.com/jinzhu/gorm)
BuildRequires:  golang(github.com/lib/pq)
BuildRequires:  golang(github.com/prometheus/client_golang/prometheus)
BuildRequires:  golang(github.com/Shopify/logrus-bugsnag)
BuildRequires:  golang(github.com/sirupsen/logrus)
BuildRequires:  golang(github.com/spf13/cobra)
BuildRequires:  golang(github.com/spf13/viper)
BuildRequires:  golang(github.com/stretchr/testify/require)
BuildRequires:  golang(github.com/theupdateframework/notary)
BuildRequires:  golang(github.com/theupdateframework/notary/client)
BuildRequires:  golang(github.com/theupdateframework/notary/client/changelist)
BuildRequires:  golang(github.com/theupdateframework/notary/cryptoservice)
BuildRequires:  golang(github.com/theupdateframework/notary/passphrase)
BuildRequires:  golang(github.com/theupdateframework/notary/proto)
BuildRequires:  golang(github.com/theupdateframework/notary/server)
BuildRequires:  golang(github.com/theupdateframework/notary/server/errors)
BuildRequires:  golang(github.com/theupdateframework/notary/server/handlers)
BuildRequires:  golang(github.com/theupdateframework/notary/server/snapshot)
BuildRequires:  golang(github.com/theupdateframework/notary/server/storage)
BuildRequires:  golang(github.com/theupdateframework/notary/server/timestamp)
BuildRequires:  golang(github.com/theupdateframework/notary/signer)
BuildRequires:  golang(github.com/theupdateframework/notary/signer/api)
BuildRequires:  golang(github.com/theupdateframework/notary/signer/client)
BuildRequires:  golang(github.com/theupdateframework/notary/signer/keydbstore)
BuildRequires:  golang(github.com/theupdateframework/notary/storage)
BuildRequires:  golang(github.com/theupdateframework/notary/storage/rethinkdb)
BuildRequires:  golang(github.com/theupdateframework/notary/trustmanager)
BuildRequires:  golang(github.com/theupdateframework/notary/trustmanager/remoteks)
BuildRequires:  golang(github.com/theupdateframework/notary/trustpinning)
BuildRequires:  golang(github.com/theupdateframework/notary/tuf)
BuildRequires:  golang(github.com/theupdateframework/notary/tuf/data)
BuildRequires:  golang(github.com/theupdateframework/notary/tuf/signed)
BuildRequires:  golang(github.com/theupdateframework/notary/tuf/testutils/keys)
BuildRequires:  golang(github.com/theupdateframework/notary/tuf/utils)
BuildRequires:  golang(github.com/theupdateframework/notary/tuf/validation)
BuildRequires:  golang(github.com/theupdateframework/notary/utils)
BuildRequires:  golang(github.com/theupdateframework/notary/version)
BuildRequires:  golang(golang.org/x/crypto/pbkdf2)
BuildRequires:  golang(golang.org/x/crypto/ssh/terminal)
BuildRequires:  golang(golang.org/x/net/context)
BuildRequires:  golang(golang.org/x/sys/unix)
BuildRequires:  golang(google.golang.org/grpc)
BuildRequires:  golang(google.golang.org/grpc/codes)
BuildRequires:  golang(google.golang.org/grpc/credentials)
BuildRequires:  golang(google.golang.org/grpc/health)
BuildRequires:  golang(google.golang.org/grpc/health/grpc_health_v1)
BuildRequires:  golang(gopkg.in/dancannon/gorethink.v3)

%if %{with check}
# Tests
BuildRequires:  golang(github.com/docker/distribution/registry/auth/silly)
BuildRequires:  golang(github.com/mattn/go-sqlite3)
BuildRequires:  golang(github.com/theupdateframework/notary/tuf/testutils)
BuildRequires:  golang(github.com/theupdateframework/notary/tuf/testutils/interfaces)
%endif

%description
%{common_description}

%gopkg

%prep
%goprep

%build
for cmd in cmd/* ; do
  %gobuild -o %{gobuilddir}/bin/$(basename $cmd) %{goipath}/$cmd
done

%install
%gopkginstall
install -m 0755 -vd                     %{buildroot}%{_bindir}
install -m 0755 -vp %{gobuilddir}/bin/* %{buildroot}%{_bindir}/

%if %{with check}
%check
%gocheck
%endif

%files
%license LICENSE tuf/LICENSE
%doc docs CONTRIBUTING.md CONTRIBUTORS MAINTAINERS_RULES.md README.md
%doc CHANGELOG.md ROADMAP.md fixtures/compatibility/README.md
%doc fixtures/compatibility/notary0.1/README.txt migrations/README.md
%doc trustmanager/importLogic.md tuf/README.md
%{_bindir}/*

%gopkgfiles

%changelog

